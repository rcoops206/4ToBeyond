<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LYTIC - Code Breaking Game</title>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- User Navigation -->
    <div class="user-nav">
        <div class="profile-container">
            <div class="profile-icon" onclick="toggleProfileDropdown()">üë§</div>
            <div class="profile-dropdown" id="profileDropdown">
                <div class="profile-header">
                    <div class="profile-avatar">üë§</div>
                    <div class="profile-name" id="profileName">Loading...</div>
                    <div class="profile-email" id="profileEmail">Please wait...</div>
                </div>
                <ul class="profile-menu" id="profileMenu">
                    <!-- Menu items will be dynamically generated -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Reset Button -->
    <div class="reset-nav">
        <button class="reset-button" onclick="showGameSetup()">
            üîÑ <span>Reset</span>
        </button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="title" onclick="window.location.href='hub.html'">LYTIC</h1>
            <p class="subtitle">Crack the code with perfect precision</p>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <div class="guess-container">
                <input type="text" id="guessInput" placeholder="Click 'Reset' to start!" maxlength="7" class="guess-input" disabled>
                <button id="submitBtn" onclick="submitGuess()" class="btn btn-primary" disabled>Submit</button>
            </div>
            <div id="feedback" class="feedback">
                Select a code length and click "Reset" to start playing!
            </div>
        </div>

        <!-- Game Progress and Strategy Grid -->
        <div class="game-grid">
            <!-- Game Progress -->
            <div class="progress-section">
                <div class="section-header">
                    <span>üìä Game Progress</span>
                    <span class="turn-counter">Turn: <span id="turnCounter">0</span></span>
                </div>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Turn</th>
                            <th>Guess</th>
                            <th>Correct</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody"></tbody>
                </table>
            </div>

            <!-- Strategy Grid -->
            <div class="strategy-section">
                <div class="section-header">
                    <span>üéØ Strategy Grid</span>
                </div>
                <div class="grid-instructions">
                    <div class="grid-legend">
                        <span>Click cells:</span>
                        <span class="legend-item legend-no">‚úó No</span>
                        <span>‚Üí</span>
                        <span class="legend-item legend-yes">‚úì Yes</span>
                        <span>‚Üí</span>
                        <span class="legend-item legend-empty">Empty</span>
                    </div>
                </div>
                <div id="eliminationGrid" class="strategy-grid"></div>
            </div>
        </div>

        <!-- Win Message -->
        <div id="winMessage" class="win-message hidden">
            üéâ VICTORY! You cracked the code! üéâ
        </div>
    </div>

    <!-- Game Setup Modal -->
    <div class="game-setup-modal" id="gameSetupModal">
        <div class="setup-content">
            <div class="setup-icon">üéØ</div>
            <h2 class="setup-title">Start New Game</h2>
            <p class="setup-subtitle">Choose your difficulty level and crack the code!</p>
            
            <div class="setup-form">
                <div class="form-group">
                    <label class="form-label" for="setupCodeLength">Difficulty Level</label>
                    <select id="setupCodeLength" class="form-select" onchange="updateDifficultyPreview()">
                        <option value="4">Easy - 4 Digits</option>
                        <option value="5">Medium - 5 Digits</option>
                        <option value="6">Hard - 6 Digits</option>
                        <option value="7">Expert - 7 Digits</option>
                    </select>
                    <div class="difficulty-preview">
                        <div class="difficulty-text" id="difficultyText">Perfect for beginners</div>
                        <div class="difficulty-indicator" id="difficultyIndicator">
                            <div class="difficulty-dot active"></div>
                            <div class="difficulty-dot"></div>
                            <div class="difficulty-dot"></div>
                            <div class="difficulty-dot"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="setup-actions">
                <button class="btn btn-confirm" onclick="startNewGameFromModal()">Start Game</button>
            </div>
        </div>
    </div>

    <!-- Save Result Modal -->
    <div id="saveModal" class="save-modal">
        <div class="save-content">
            <h2 class="save-title">üéâ Game Complete!</h2>
            <div class="save-stats" id="saveStats">
                <!-- Stats will be populated here -->
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button class="btn btn-primary" onclick="saveResult()">Save Result</button>
                <button class="btn btn-secondary" onclick="hideSaveModal()">Skip</button>
            </div>
        </div>
    </div>

    <!-- Dashboard Modal -->
    <div id="dashboardModal" class="dashboard-modal">
        <div class="dashboard-content">
            <div class="dashboard-header">
                <h1 class="dashboard-title">üìä Player Dashboard</h1>
                <button class="close-button" onclick="hideDashboard()">√ó</button>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-state">
                <div class="loading-spinner"></div>
                <p>Loading your dashboard...</p>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardData" style="display: none;">
                <!-- User Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">Total Games</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-value" id="gamesWon">0</div>
                        <div class="stat-label">Games Won</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-value" id="bestScore">0</div>
                        <div class="stat-label">Best Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-value" id="avgAttempts">0</div>
                        <div class="stat-label">Avg Attempts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-value" id="avgTime">0s</div>
                        <div class="stat-label">Avg Time</div>
                    </div>
                </div>

                <!-- Performance Analytics -->
                <div class="performance-section">
                    <h2 class="section-title">üìä Performance Analytics</h2>
                    <div class="chart-card">
                        <div class="chart-header">Performance by Difficulty</div>
                        <div class="difficulty-breakdown" id="difficultyBreakdown">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Recent Games -->
                <div class="recent-games">
                    <h2 class="section-title">üïí Last 10 Games</h2>
                    <div class="table-container">
                        <table class="games-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Difficulty</th>
                                    <th>Attempts</th>
                                    <th>Time</th>
                                    <th>Score</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentGamesTable">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error-state" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h3>Unable to Load Dashboard</h3>
                <p>Please check your connection and try again.</p>
                <button class="btn btn-primary" onclick="loadDashboard()">Retry</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modals -->
    <!-- Sign Out Modal -->
    <div class="modal-overlay" id="signOutModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üö™</div>
                <h3 class="modal-title">Sign Out</h3>
                <p class="modal-message">Are you sure you want to sign out? You'll need to log in again to access your account.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('signOut', false)">Cancel</button>
                <button class="btn btn-confirm" onclick="closeModal('signOut', true)">Sign Out</button>
            </div>
        </div>
    </div>

    <!-- New Game Modal -->
    <div class="modal-overlay" id="newGameModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üéØ</div>
                <h3 class="modal-title">Start New Game?</h3>
                <p class="modal-message">You have a game in progress. Starting a new game will lose your current progress.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('newGame', false)">Continue Current Game</button>
                <button class="btn btn-confirm" onclick="closeModal('newGame', true)">Start New Game</button>
            </div>
        </div>
    </div>

    <!-- Guest Sign Up Modal -->
    <div class="modal-overlay" id="guestSignUpModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üéâ</div>
                <h3 class="modal-title">Great job! Your result has been saved anonymously.</h3>
                <div class="modal-stats" id="modalGameStats">
                    <!-- Game stats will be populated here -->
                </div>
                <p class="modal-message">Sign in to save results to your profile and compete on leaderboards?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('guestSignUp', false)">Maybe Later</button>
                <button class="btn btn-confirm" onclick="closeModal('guestSignUp', true)">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Dashboard Sign In Modal -->
    <div class="modal-overlay" id="dashboardSignInModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üìä</div>
                <h3 class="modal-title">Sign In Required</h3>
                <p class="modal-message">Sign in to access your profile dashboard and track your progress!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('dashboardSignIn', false)">Maybe Later</button>
                <button class="btn btn-confirm" onclick="closeModal('dashboardSignIn', true)">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Play Another Modal -->
    <div class="modal-overlay" id="playAnotherModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">üéÆ</div>
                <h3 class="modal-title">Result saved!</h3>
                <p class="modal-message">Play another game?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('playAnother', false)">Finish Playing</button>
                <button class="btn btn-confirm" onclick="closeModal('playAnother', true)">New Game</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>