<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LYTIC - Code Breaking Game</title>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- User Navigation -->
    <div class="user-nav">
        <div class="profile-container">
            <div class="profile-icon" onclick="toggleProfileDropdown()">ğŸ‘¤</div>
            <div class="profile-dropdown" id="profileDropdown">
                <div class="profile-header">
                    <div class="profile-avatar">ğŸ‘¤</div>
                    <div class="profile-name" id="profileName">Loading...</div>
                    <div class="profile-email" id="profileEmail">Please wait...</div>
                </div>
                <ul class="profile-menu" id="profileMenu">
                    <!-- Menu items will be dynamically generated -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Reset Button and Help -->
    <div class="reset-nav">
        <button class="reset-button" onclick="showGameSetup()">
            ğŸ”„ <span>Reset</span>
        </button>
        <button class="help-button" onclick="showHelpModal()">
            â“ <span>Help</span>
        </button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="title" onclick="window.location.href='hub.html'">LYTIC</h1>
            <p class="subtitle">Crack the code with perfect precision</p>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <div class="guess-container">
                <input type="text" id="guessInput" placeholder="Click 'Reset' to start!" maxlength="7" class="guess-input" disabled>
                <button id="submitBtn" onclick="submitGuess()" class="btn btn-primary" disabled>Submit</button>
            </div>
            <div id="feedback" class="feedback">
                Select a code length and click "Reset" to start playing!
            </div>
        </div>

        <!-- Game Progress and Strategy Grid -->
        <div class="game-grid">
            <!-- Game Progress -->
            <div class="progress-section">
                <div class="section-header">
                    <span>ğŸ“Š Game Progress</span>
                    <span class="turn-counter">Turn: <span id="turnCounter">0</span></span>
                </div>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Turn</th>
                            <th>Guess</th>
                            <th>Correct</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody"></tbody>
                </table>
            </div>

            <!-- Strategy Grid -->
            <div class="strategy-section">
                <div class="section-header">
                    <span>ğŸ¯ Strategy Grid</span>
                </div>
                <div class="grid-instructions">
                    <div class="grid-legend">
                        <span>Click cells:</span>
                        <span class="legend-item legend-no">âœ— No</span>
                        <span>â†’</span>
                        <span class="legend-item legend-yes">âœ“ Yes</span>
                        <span>â†’</span>
                        <span class="legend-item legend-empty">Empty</span>
                    </div>
                </div>
                <div id="eliminationGrid" class="strategy-grid"></div>
            </div>
        </div>

        <!-- Win Message -->
        <div id="winMessage" class="win-message hidden">
            ğŸ‰ VICTORY! You cracked the code! ğŸ‰
        </div>
    </div>

    <!-- Game Setup Modal -->
    <div class="game-setup-modal" id="gameSetupModal">
        <div class="setup-content">
            <div class="setup-icon">ğŸ¯</div>
            <h2 class="setup-title">Start New Game</h2>
            <p class="setup-subtitle">Choose your difficulty level and crack the code!</p>
            
            <div class="setup-form">
                <div class="form-group">
                    <label class="form-label" for="setupCodeLength">Difficulty Level</label>
                    <select id="setupCodeLength" class="form-select" onchange="updateDifficultyPreview()">
                        <option value="4">Easy - 4 Digits</option>
                        <option value="5">Medium - 5 Digits</option>
                        <option value="6">Hard - 6 Digits</option>
                        <option value="7">Expert - 7 Digits</option>
                    </select>
                    <div class="difficulty-preview">
                        <div class="difficulty-text" id="difficultyText">Perfect for beginners</div>
                        <div class="difficulty-indicator" id="difficultyIndicator">
                            <div class="difficulty-dot active"></div>
                            <div class="difficulty-dot"></div>
                            <div class="difficulty-dot"></div>
                            <div class="difficulty-dot"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="setup-actions">
                <button class="btn btn-confirm" onclick="startNewGameFromModal()">Start Game</button>
            </div>
        </div>
    </div>

    <!-- Save Result Modal -->
    <div id="saveModal" class="save-modal">
        <div class="save-content">
            <h2 class="save-title">ğŸ‰ Game Complete!</h2>
            <div class="save-stats" id="saveStats">
                <!-- Stats will be populated here -->
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button class="btn btn-primary" onclick="saveResult()">Save Result</button>
                <button class="btn btn-secondary" onclick="hideSaveModal()">Skip</button>
            </div>
        </div>
    </div>

    <!-- Dashboard Modal -->
    <div id="dashboardModal" class="dashboard-modal">
        <div class="dashboard-content">
            <div class="dashboard-header">
                <h1 class="dashboard-title">ğŸ“Š Player Dashboard</h1>
                <button class="close-button" onclick="hideDashboard()">Ã—</button>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-state">
                <div class="loading-spinner"></div>
                <p>Loading your dashboard...</p>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardData" style="display: none;">
                <!-- User Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">Total Games</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ†</div>
                        <div class="stat-value" id="gamesWon">0</div>
                        <div class="stat-label">Games Won</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“ˆ</div>
                        <div class="stat-value" id="bestAttempts">--</div>
                        <div class="stat-label">Best Attempts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â­</div>
                        <div class="stat-value" id="bestScore">0</div>
                        <div class="stat-label">Best Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âš¡</div>
                        <div class="stat-value" id="avgAttempts">0</div>
                        <div class="stat-label">Avg Attempts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â±ï¸</div>
                        <div class="stat-value" id="avgTime">0s</div>
                        <div class="stat-label">Avg Time</div>
                    </div>
                </div>

                <!-- Performance Analytics -->
                <div class="performance-section">
                    <h2 class="section-title">ğŸ“Š Performance Analytics</h2>
                    <div class="chart-card">
                        <div class="chart-header">Performance by Difficulty</div>
                        <div class="difficulty-breakdown" id="difficultyBreakdown">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Recent Games -->
                <div class="recent-games">
                    <h2 class="section-title">ğŸ•’ Last 10 Games</h2>
                    <div class="table-container">
                        <table class="games-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Difficulty</th>
                                    <th>Attempts</th>
                                    <th>Time</th>
                                    <th>Score</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentGamesTable">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error-state" style="display: none;">
                <div class="error-icon">âš ï¸</div>
                <h3>Unable to Load Dashboard</h3>
                <p>Please check your connection and try again.</p>
                <button class="btn btn-primary" onclick="loadDashboard()">Retry</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modals -->
    <!-- Sign Out Modal -->
    <div class="modal-overlay" id="signOutModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">ğŸšª</div>
                <h3 class="modal-title">Sign Out</h3>
                <p class="modal-message">Are you sure you want to sign out? You'll need to log in again to access your account.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('signOut', false)">Cancel</button>
                <button class="btn btn-confirm" onclick="closeModal('signOut', true)">Sign Out</button>
            </div>
        </div>
    </div>

    <!-- New Game Modal -->
    <div class="modal-overlay" id="newGameModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">ğŸ¯</div>
                <h3 class="modal-title">Start New Game?</h3>
                <p class="modal-message">You have a game in progress. Starting a new game will lose your current progress.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('newGame', false)">Continue Current Game</button>
                <button class="btn btn-confirm" onclick="closeModal('newGame', true)">Start New Game</button>
            </div>
        </div>
    </div>

    <!-- Guest Sign Up Modal -->
    <div class="modal-overlay" id="guestSignUpModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">ğŸ‰</div>
                <h3 class="modal-title">Great job! Your result has been saved anonymously.</h3>
                <div class="modal-stats" id="modalGameStats">
                    <!-- Game stats will be populated here -->
                </div>
                <p class="modal-message">Sign in to save results to your profile and compete on leaderboards?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('guestSignUp', false)">Maybe Later</button>
                <button class="btn btn-confirm" onclick="closeModal('guestSignUp', true)">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Dashboard Sign In Modal -->
    <div class="modal-overlay" id="dashboardSignInModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">ğŸ“Š</div>
                <h3 class="modal-title">Sign In Required</h3>
                <p class="modal-message">Sign in to access your profile dashboard and track your progress!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('dashboardSignIn', false)">Maybe Later</button>
                <button class="btn btn-confirm" onclick="closeModal('dashboardSignIn', true)">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Play Another Modal -->
    <div class="modal-overlay" id="playAnotherModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">ğŸ®</div>
                <h3 class="modal-title">Result saved!</h3>
                <p class="modal-message">Play another game?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal('playAnother', false)">Finish Playing</button>
                <button class="btn btn-confirm" onclick="closeModal('playAnother', true)">New Game</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal help-modal">
            <div class="help-header">
                <div class="help-icon">ğŸ®</div>
                <h2 class="help-title">LYTIC â€“ Quick Start Guide</h2>
                <button class="help-close" onclick="closeModal('help', false)">Ã—</button>
            </div>
            <div class="help-content">
                <div class="help-section">
                    <div class="help-section-icon">ğŸ¯</div>
                    <h3 class="help-section-title">Goal</h3>
                    <p>Crack the <strong>secret number code</strong> by using logic and deduction. The fewer guesses and the faster you solve, the higher your score!</p>
                </div>

                <div class="help-section">
                    <div class="help-section-icon">ğŸ”¢</div>
                    <h3 class="help-section-title">How to Play</h3>
                    
                    <div class="help-subsection">
                        <h4>1. Choose Your Difficulty</h4>
                        <div class="difficulty-levels">
                            <div class="difficulty-level easy">
                                <span class="level-name">Easy (4 digits)</span>
                                <span class="level-desc">Great for beginners â€“ fewer possibilities</span>
                            </div>
                            <div class="difficulty-level medium">
                                <span class="level-name">Medium (5 digits)</span>
                                <span class="level-desc">More complex â€“ requires structured guessing</span>
                            </div>
                            <div class="difficulty-level hard">
                                <span class="level-name">Hard (6 digits)</span>
                                <span class="level-desc">Serious challenge â€“ advanced logic needed</span>
                            </div>
                            <div class="difficulty-level expert">
                                <span class="level-name">Expert (7 digits)</span>
                                <span class="level-desc">For master codebreakers â€“ millions of combinations!</span>
                            </div>
                        </div>
                    </div>

                    <div class="help-subsection">
                        <h4>2. Make a Guess</h4>
                        <ul>
                            <li>Enter a number with the <strong>same number of digits</strong> as the code</li>
                            <li>Each guess is tested against the secret code</li>
                        </ul>
                        <div class="help-tip">
                            <span class="tip-icon">ğŸ‘‰</span>
                            <span>Example: If the secret code has 5 digits, all of your guesses must also be 5 digits.</span>
                        </div>
                    </div>

                    <div class="help-subsection">
                        <h4>3. Read the Feedback</h4>
                        <p>After every guess, you'll get feedback:</p>
                        <ul>
                            <li>It tells you <strong>how many digits are correct AND in the right position</strong></li>
                            <li>It does <strong>not</strong> tell you <em>which</em> digits are correct â€“ that's the puzzle!</li>
                        </ul>
                        <div class="help-example">
                            <div class="example-header">âš¡ Example:</div>
                            <div class="example-content">
                                <div class="example-line">Secret code: <code>7239</code></div>
                                <div class="example-line">Your guess: <code>7145</code></div>
                                <div class="example-line">Feedback: <strong>"1 correct"</strong> (only the <code>7</code> in position 1 matches)</div>
                            </div>
                        </div>
                    </div>

                    <div class="help-subsection">
                        <h4>4. Use Logic to Improve</h4>
                        <ul>
                            <li><strong>Eliminate</strong> digits that don't work</li>
                            <li><strong>Confirm</strong> digits that are correct</li>
                            <li><strong>Refine</strong> guesses step by step until the whole code is solved</li>
                        </ul>
                        <div class="help-callout">
                            It's like cracking a safe: every piece of feedback narrows the possibilities!
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <div class="help-section-icon">ğŸ› </div>
                    <h3 class="help-section-title">Tools to Help You</h3>
                    <ul>
                        <li><strong>Strategy Grid</strong> â€“ Mark which digits can or can't go in each position</li>
                        <li><strong>Guess History</strong> â€“ Review all past guesses and feedback to avoid repeating mistakes</li>
                        <li><strong>Real-Time Feedback</strong> â€“ See progress immediately after each guess</li>
                    </ul>
                </div>

                <div class="help-section">
                    <div class="help-section-icon">ğŸ†</div>
                    <h3 class="help-section-title">Scoring</h3>
                    <p>Your score depends on:</p>
                    <div class="scoring-factors">
                        <div class="factor">
                            <span class="factor-icon">âš¡</span>
                            <span><strong>Fewer Guesses = Higher Score</strong></span>
                        </div>
                        <div class="factor">
                            <span class="factor-icon">â±ï¸</span>
                            <span><strong>Faster Solving = Bonus Points</strong></span>
                        </div>
                        <div class="factor">
                            <span class="factor-icon">ğŸ¯</span>
                            <span><strong>Harder Difficulty = Bigger Rewards</strong></span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <div class="help-section-icon">ğŸ’¡</div>
                    <h3 class="help-section-title">Pro Tips</h3>
                    <div class="pro-tips">
                        <div class="tip">
                            <span class="tip-title">Start Broad:</span>
                            <span>Use early guesses to test as many different digits as possible.</span>
                        </div>
                        <div class="tip">
                            <span class="tip-title">Be Systematic:</span>
                            <span>Don't guess randomlyâ€”use the feedback to eliminate options.</span>
                        </div>
                        <div class="tip">
                            <span class="tip-title">Narrow Down:</span>
                            <span>Once you know a digit is correct, test where it belongs.</span>
                        </div>
                        <div class="tip">
                            <span class="tip-title">Think Ahead:</span>
                            <span>Each guess should give you maximum information, not just a lucky shot.</span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <div class="help-section-icon">ğŸ‰</div>
                    <h3 class="help-section-title">Winning</h3>
                    <p>You win by cracking the <strong>entire code</strong>! Each correct digit locks into place, and the game celebrates when you solve it. ğŸ…</p>
                </div>
            </div>
            <div class="help-footer">
                <button class="btn btn-primary help-play-btn" onclick="closeHelpAndStartGame()">Start Playing!</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
</body>

<!-- Add this footer to your main game HTML -->
<footer class="legal-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="privacy.html">Privacy Policy</a>
            <a href="terms.html">Terms of Service</a>
            <a href="contact.html">Contact & About</a>
        </div>
        <p class="footer-text">&copy; 2025 LYTIC Game. All rights reserved.</p>
    </div>
</footer>
</body>
</html>